
name: Test APIs

on:
  workflow_dispatch:
  push:
    branches:
      - main

env:
  GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
  PEXELS_API_KEY: ${{ secrets.PEXELS_API_KEY }}

jobs:
  test-gemini:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          
      - name: Install dependencies
        run: pip install google-generativeai python-dotenv

      - name: Run Gemini Test
        run: |
          python -c "
import os
import google.generativeai as genai
from dotenv import load_dotenv
load_dotenv()
api_key = os.getenv('GEMINI_API_KEY')
if not api_key:
    print('GEMINI_API_KEY secret not found!')
    exit(1)
genai.configure(api_key=api_key)
model = genai.GenerativeModel('gemini-1.5-flash')
try:
    response = model.generate_content('Test prompt')
    if response.text:
        print('Gemini API test successful!')
    else:
        print('Gemini API test failed: empty response.')
        exit(1)
except Exception as e:
    print(f'Gemini API test failed: {e}')
    exit(1)
"
  test-pexels:
    runs-on: ubuntu-latest
    steps:
      - name: Run Pexels Test
        run: |
          if [ -z "$PEXELS_API_KEY" ]; then
            echo "PEXELS_API_KEY secret not found!"
            exit 1
          fi
          response=$(curl -s -o /dev/null -w "%{http_code}" -H "Authorization: $PEXELS_API_KEY" "https://api.pexels.com/v1/search?query=nature&per_page=1")
          if [ "$response" -eq 200 ]; then
            echo "Pexels API test successful!"
          else
            echo "Pexels API test failed with HTTP status code: $response"
            exit 1
          fi
